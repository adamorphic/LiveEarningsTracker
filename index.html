<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Earnings Tracker</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- iOS PWA meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Earnings Tracker">
    <meta name="theme-color" content="#10b981">
    
    <!-- iOS icon -->
    <link rel="apple-touch-icon" href="android-chrome-192x192.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PDF.js for PDF parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <!-- React Component -->
    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;
        
        // Utility function for debouncing
        const debounce = (func, wait) => {
          let timeout;
          return function executedFunction(...args) {
            const later = () => {
              clearTimeout(timeout);
              func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
          };
        };
        
        // Lucide icons as components
        const Clock = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>;
        const DollarSign = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>;
        const Target = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>;
        const TrendingUp = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22,7 13.5,15.5 8.5,10.5 2,17"/><polyline points="16,7 22,7 22,13"/></svg>;
        const Calendar = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>;
        const PieChart = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>;
        const Settings = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>;
        const X = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>;
        const Download = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7,10 12,15 17,10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const Zap = ({size = 24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"/></svg>;

        const LiveEarningsTracker = () => {
          const [currentTime, setCurrentTime] = useState(new Date());
          const [view, setView] = useState('today');
          const [showSettings, setShowSettings] = useState(false);
          const [lastDollarAmount, setLastDollarAmount] = useState(0);
          const [deferredPrompt, setDeferredPrompt] = useState(null);
          const [showInstallPrompt, setShowInstallPrompt] = useState(false);
          const [parsedPayStub, setParsedPayStub] = useState(null);
          const [isParsingPDF, setIsParsingPDF] = useState(false);
          const [goals, setGoals] = useState(() => {
            const savedGoals = localStorage.getItem('earningsTrackerGoals');
            return savedGoals ? JSON.parse(savedGoals) : {
              daily: 150,
              weekly: 750,
              monthly: 3000
            };
          });
          const [showGoals, setShowGoals] = useState(false);
          const [showInvestmentCalc, setShowInvestmentCalc] = useState(false);
          const [investmentSettings, setInvestmentSettings] = useState(() => {
            const saved = localStorage.getItem('earningsTrackerInvestment');
            return saved ? JSON.parse(saved) : {
              annualReturn: 7, // 7% default
              timeHorizon: 30, // 30 years default
              monthlyContribution: 0 // additional monthly contribution
            };
          });

          // User settings with localStorage
          const [settings, setSettings] = useState(() => {
            const savedSettings = localStorage.getItem('earningsTrackerSettings');
            if (savedSettings) {
              try {
                return JSON.parse(savedSettings);
              } catch (e) {
                console.log('Error loading saved settings:', e);
              }
            }
            return {
              hourlyRate: 19.20,
              workStartHour: 9,
              workStartMinute: 30,
              workEndHour: 18,
              workEndMinute: 30,
              lunchStartHour: 13,
              lunchStartMinute: 0,
              lunchEndHour: 14,
              lunchEndMinute: 0,
              payPeriodStartDate: '2025-08-07',
              payPeriodLength: 14,
              federalTaxRate: 12,
              stateTaxRate: 5,
              socialSecurityRate: 6.2,
              medicareRate: 1.45,
              otherDeductions: 0,
              overtimeThreshold: 8,
              overtimeMultiplier: 1.5
            };
          });

          // Sound preference with localStorage
          const [soundEnabled, setSoundEnabled] = useState(() => {
            const savedSound = localStorage.getItem('earningsTrackerSound');
            return savedSound !== null ? JSON.parse(savedSound) : true;
          });

          const WORK_DAYS = [1, 2, 3, 4, 5];

          // Save settings to localStorage whenever they change
          useEffect(() => {
            localStorage.setItem('earningsTrackerSettings', JSON.stringify(settings));
          }, [settings]);

          // Save goals to localStorage
          useEffect(() => {
            localStorage.setItem('earningsTrackerGoals', JSON.stringify(goals));
          }, [goals]);

          // Save investment settings
          useEffect(() => {
            localStorage.setItem('earningsTrackerInvestment', JSON.stringify(investmentSettings));
          }, [investmentSettings]);

          // Save sound preference
          useEffect(() => {
            localStorage.setItem('earningsTrackerSound', JSON.stringify(soundEnabled));
          }, [soundEnabled]);

          // Debounced time update for better performance
          const debouncedTimeUpdate = useCallback(
            debounce(() => setCurrentTime(new Date()), 100),
            []
          );

          // Update time every second
          useEffect(() => {
            const timer = setInterval(() => {
              debouncedTimeUpdate();
            }, 1000);
            return () => clearInterval(timer);
          }, [debouncedTimeUpdate]);

          // PWA Installation handling
          useEffect(() => {
            const handleBeforeInstallPrompt = (e) => {
              e.preventDefault();
              setDeferredPrompt(e);
              setShowInstallPrompt(true);
            };

            if (typeof window !== 'undefined') {
              window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
            }

            return () => {
              if (typeof window !== 'undefined') {
                window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
              }
            };
          }, []);

          // Handle PWA installation
          const handleInstallClick = async () => {
            if (!deferredPrompt) {
              const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
              if (isIOS) {
                alert('To install on iOS:\n1. Tap the Share button in Safari\n2. Scroll down and tap "Add to Home Screen"\n3. Tap "Add" to install the app');
              } else {
                alert('To install this app:\n1. Look for an install prompt in your browser\n2. Or check your browser menu for "Install App" option');
              }
              return;
            }

            try {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;
              
              if (outcome === 'accepted') {
                console.log('PWA installed');
              }
              
              setDeferredPrompt(null);
              setShowInstallPrompt(false);
            } catch (e) {
              console.log('Install failed:', e);
            }
          };

          // Enhanced PDF parsing with better error handling
          const parsePayStubText = (text) => {
            const parsed = {};
            console.log('Full PDF text for debugging:', text);
            
            // Normalize text - remove extra spaces, standardize currency symbols
            const normalizedText = text.replace(/\s+/g, ' ').replace(/[$]/g, '').trim();
            
            // More comprehensive hourly rate patterns
            const hourlyRatePatterns = [
              // Standard patterns
              /(?:hourly\s*rate|rate\s*per\s*hour|base\s*rate)[:\s]*(\d+\.?\d*)/gi,
              /(\d+\.?\d*)\s*(?:\/\s*hr|per\s*hr|hourly)/gi,
              
              // Table-style patterns (common in payroll systems)
              /regular\s+(\d+\.?\d*)\s+(\d+\.?\d*)\s+(\d+\.?\d*)/gi, // hours, rate, total
              /(\d+\.?\d*)\s*hrs?\s*@?\s*(\d+\.?\d*)/gi,
              
              // ADP/Workday style patterns
              /regular\s*pay[:\s]*(\d+\.?\d*)/gi,
              /base\s*hourly[:\s]*(\d+\.?\d*)/gi,
              
              // Look for patterns like "40.00 19.50 780.00" (hours, rate, total)
              /(\d{1,3}\.?\d*)\s+(\d{1,2}\.\d{2})\s+(\d{2,4}\.\d{2})/g
            ];
            
            for (const pattern of hourlyRatePatterns) {
              const matches = [...normalizedText.matchAll(pattern)];
              for (const match of matches) {
                let rate;
                
                // Handle different match group structures
                if (match.length === 4) { // hours, rate, total pattern
                  rate = parseFloat(match[2]);
                  const hours = parseFloat(match[1]);
                  const total = parseFloat(match[3]);
                  
                  // Validate calculation makes sense
                  if (Math.abs((hours * rate) - total) < 1) {
                    parsed.hourlyRate = rate;
                    break;
                  }
                } else {
                  rate = parseFloat(match[1]);
                }
                
                // Validate rate is reasonable
                if (rate >= 7.25 && rate <= 150) { // Min wage to reasonable max
                  parsed.hourlyRate = rate;
                  break;
                }
              }
              if (parsed.hourlyRate) break;
            }
            
            // Enhanced gross pay detection with validation
            const grossPayPatterns = [
              /gross\s*pay[:\s]*(\d+\.?\d*)/gi,
              /total\s*gross[:\s]*(\d+\.?\d*)/gi,
              /current\s*gross[:\s]*(\d+\.?\d*)/gi,
              /gross\s*earnings[:\s]*(\d+\.?\d*)/gi,
              // Pattern for YTD vs current period
              /gross\s*(\d+\.?\d*)\s*(\d+\.?\d*)/gi // often current, YTD
            ];
            
            let grossPay = null;
            for (const pattern of grossPayPatterns) {
              const matches = [...normalizedText.matchAll(pattern)];
              for (const match of matches) {
                let amount;
                if (match.length === 3) {
                  // Take the smaller number (likely current period, not YTD)
                  amount = Math.min(parseFloat(match[1]), parseFloat(match[2]));
                } else {
                  amount = parseFloat(match[1]);
                }
                
                // Validate gross pay is reasonable for a pay period
                if (amount >= 100 && amount <= 20000) {
                  grossPay = amount;
                  break;
                }
              }
              if (grossPay) break;
            }
            
            // Calculate tax rates with better error handling
            const calculateTaxRate = (patterns, grossPay, expectedRange) => {
              for (const pattern of patterns) {
                const matches = [...normalizedText.matchAll(pattern)];
                for (const match of matches) {
                  const taxAmount = parseFloat(match[1]);
                  if (taxAmount > 0 && grossPay && taxAmount < grossPay * 0.5) {
                    const rate = (taxAmount / grossPay) * 100;
                    if (rate >= expectedRange.min && rate <= expectedRange.max) {
                      return rate.toFixed(2);
                    }
                  }
                }
              }
              return null;
            };
            
            // Federal tax patterns with validation
            const federalTaxPatterns = [
              /federal\s*(?:income\s*)?tax[:\s]*(\d+\.?\d*)/gi,
              /fed\s*tax[:\s]*(\d+\.?\d*)/gi,
              /fit[:\s]*(\d+\.?\d*)/gi,
              /federal\s*withholding[:\s]*(\d+\.?\d*)/gi
            ];
            
            if (grossPay) {
              parsed.federalTaxRate = calculateTaxRate(federalTaxPatterns, grossPay, {min: 0, max: 37});
              
              // State tax
              const stateTaxPatterns = [
                /state\s*(?:income\s*)?tax[:\s]*(\d+\.?\d*)/gi,
                /sit[:\s]*(\d+\.?\d*)/gi,
                /state\s*withholding[:\s]*(\d+\.?\d*)/gi
              ];
              parsed.stateTaxRate = calculateTaxRate(stateTaxPatterns, grossPay, {min: 0, max: 13});
              
              // Social Security
              const ssPatterns = [
                /(?:social\s*security|ss|oasdi)[:\s]*(\d+\.?\d*)/gi,
                /soc\s*sec[:\s]*(\d+\.?\d*)/gi
              ];
              parsed.socialSecurityRate = calculateTaxRate(ssPatterns, grossPay, {min: 5, max: 7});
              
              // Medicare
              const medicarePatterns = [
                /medicare[:\s]*(\d+\.?\d*)/gi,
                /med\s*tax[:\s]*(\d+\.?\d*)/gi
              ];
              parsed.medicareRate = calculateTaxRate(medicarePatterns, grossPay, {min: 1, max: 2});
            }
            
            // Enhanced date detection
            const datePatterns = [
              /(\d{1,2}\/\d{1,2}\/\d{4})\s*[-â€“â€”to]\s*(\d{1,2}\/\d{1,2}\/\d{4})/gi,
              /(\d{4}-\d{2}-\d{2})\s*[-â€“â€”to]\s*(\d{4}-\d{2}-\d{2})/gi,
              /pay\s*period[:\s]*(\d{1,2}\/\d{1,2}\/\d{4})\s*[-â€“â€”to]\s*(\d{1,2}\/\d{1,2}\/\d{4})/gi
            ];
            
            for (const pattern of datePatterns) {
              const matches = [...normalizedText.matchAll(pattern)];
              for (const match of matches) {
                try {
                  const startDate = new Date(match[1]);
                  const endDate = new Date(match[2]);
                  
                  if (startDate < endDate) {
                    const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                    
                    if (daysDiff >= 7 && daysDiff <= 31) {
                      parsed.payPeriodLength = daysDiff;
                      parsed.payPeriodStartDate = startDate.toISOString().split('T')[0];
                      break;
                    }
                  }
                } catch (e) {
                  continue;
                }
              }
              if (parsed.payPeriodLength) break;
            }
            
            // Log parsing results for debugging
            console.log('Parsing results:', {
              hourlyRate: parsed.hourlyRate,
              federalTaxRate: parsed.federalTaxRate,
              stateTaxRate: parsed.stateTaxRate,
              socialSecurityRate: parsed.socialSecurityRate,
              medicareRate: parsed.medicareRate,
              payPeriodLength: parsed.payPeriodLength,
              grossPayDetected: grossPay
            });
            
            return parsed;
          };

          // Parse PDF pay stub with error boundary
          const parsePDFPayStub = async (file) => {
            setIsParsingPDF(true);
            try {
              // Set up PDF.js worker
              if (typeof pdfjsLib !== 'undefined') {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
              }

              const arrayBuffer = await file.arrayBuffer();
              const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
              
              let fullText = '';
              
              // Extract text from all pages
              for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += pageText + ' ';
              }
              
              console.log('Extracted PDF text:', fullText);
              
              // Parse the text for pay stub information
              const parsed = parsePayStubText(fullText);
              setParsedPayStub(parsed);
              
              return parsed;
            } catch (error) {
              console.error('PDF parsing error:', error);
              alert('Error parsing PDF. Please make sure it\'s a valid pay stub.');
              return null;
            } finally {
              setIsParsingPDF(false);
            }
          };

          // Handle file upload
          const handleFileUpload = async (event) => {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.type !== 'application/pdf') {
              alert('Please upload a PDF file.');
              return;
            }
            
            await parsePDFPayStub(file);
          };

          // Apply parsed data to settings
          const applyParsedData = () => {
            if (!parsedPayStub) return;
            
            const newSettings = { ...settings };
            
            if (parsedPayStub.hourlyRate) {
              newSettings.hourlyRate = parseFloat(parsedPayStub.hourlyRate);
            }
            if (parsedPayStub.federalTaxRate) {
              newSettings.federalTaxRate = parseFloat(parsedPayStub.federalTaxRate);
            }
            if (parsedPayStub.stateTaxRate) {
              newSettings.stateTaxRate = parseFloat(parsedPayStub.stateTaxRate);
            }
            if (parsedPayStub.socialSecurityRate) {
              newSettings.socialSecurityRate = parseFloat(parsedPayStub.socialSecurityRate);
            }
            if (parsedPayStub.medicareRate) {
              newSettings.medicareRate = parseFloat(parsedPayStub.medicareRate);
            }
            if (parsedPayStub.otherDeductions) {
              newSettings.otherDeductions = parseFloat(parsedPayStub.otherDeductions);
            }
            if (parsedPayStub.payPeriodLength) {
              newSettings.payPeriodLength = parseInt(parsedPayStub.payPeriodLength);
            }
            if (parsedPayStub.payPeriodStartDate) {
              newSettings.payPeriodStartDate = parsedPayStub.payPeriodStartDate;
            }
            
            setSettings(newSettings);
            setParsedPayStub(null);
            alert('Settings updated from pay stub!');
          };

          // Enhanced sound effect with haptic feedback
          const playChaChing = () => {
            if (!soundEnabled) return;
            
            // Haptic feedback on mobile
            if (navigator.vibrate) {
              navigator.vibrate([50, 30, 50]);
            }
            
            try {
              const audioContext = new (window.AudioContext || window.webkitAudioContext)();
              
              const playNote = (frequency, startTime, duration) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, startTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(0.3, startTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
                
                oscillator.start(startTime);
                oscillator.stop(startTime + duration);
              };
              
              const now = audioContext.currentTime;
              playNote(523.25, now, 0.15);
              playNote(783.99, now + 0.1, 0.25);
              
            } catch (error) {
              console.log('Audio not supported');
            }
          };

          // Helper functions
          const isWorkDay = (date) => WORK_DAYS.includes(date.getDay());
          
          const isWorkTime = (date) => {
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const currentMinutes = hours * 60 + minutes;
            
            const workStartMinutes = settings.workStartHour * 60 + settings.workStartMinute;
            const workEndMinutes = settings.workEndHour * 60 + settings.workEndMinute;
            const lunchStartMinutes = settings.lunchStartHour * 60 + settings.lunchStartMinute;
            const lunchEndMinutes = settings.lunchEndHour * 60 + settings.lunchEndMinute;
            
            return currentMinutes >= workStartMinutes && 
                   currentMinutes <= workEndMinutes && 
                   !(currentMinutes >= lunchStartMinutes && currentMinutes < lunchEndMinutes);
          };

          const getPayPeriodStart = (date) => {
            const startDate = new Date(settings.payPeriodStartDate);
            const daysDiff = Math.floor((date - startDate) / (1000 * 60 * 60 * 24));
            const periodsSince = Math.floor(daysDiff / settings.payPeriodLength);
            const payPeriodStart = new Date(startDate);
            payPeriodStart.setDate(startDate.getDate() + (periodsSince * settings.payPeriodLength));
            payPeriodStart.setHours(settings.workStartHour, settings.workStartMinute, 0, 0);
            return payPeriodStart;
          };

          // Enhanced earnings calculation with overtime support
          const calculateEarnings = (startDate, endDate = currentTime) => {
            let totalMinutes = 0;
            let overtimeMinutes = 0;
            const current = new Date(startDate);
            
            while (current <= endDate) {
              if (isWorkDay(current)) {
                const dayStart = new Date(current);
                dayStart.setHours(settings.workStartHour, settings.workStartMinute, 0, 0);
                
                const dayEnd = new Date(current);
                dayEnd.setHours(settings.workEndHour, settings.workEndMinute, 0, 0);
                
                const lunchStart = new Date(current);
                lunchStart.setHours(settings.lunchStartHour, settings.lunchStartMinute, 0, 0);
                
                const lunchEnd = new Date(current);
                lunchEnd.setHours(settings.lunchEndHour, settings.lunchEndMinute, 0, 0);
                
                const effectiveStart = current.toDateString() === endDate.toDateString() ? 
                  new Date(Math.max(dayStart, startDate, current)) : dayStart;
                const effectiveEnd = current.toDateString() === endDate.toDateString() ? 
                  new Date(Math.min(dayEnd, endDate)) : dayEnd;
                
                if (effectiveStart < effectiveEnd) {
                  let workMinutes = (effectiveEnd - effectiveStart) / (1000 * 60);
                  
                  if (effectiveStart <= lunchEnd && effectiveEnd >= lunchStart) {
                    const lunchOverlapStart = new Date(Math.max(effectiveStart, lunchStart));
                    const lunchOverlapEnd = new Date(Math.min(effectiveEnd, lunchEnd));
                    workMinutes -= (lunchOverlapEnd - lunchOverlapStart) / (1000 * 60);
                  }
                  
                  const dayWorkMinutes = Math.max(0, workMinutes);
                  const overtimeThresholdMinutes = settings.overtimeThreshold * 60;
                  
                  if (dayWorkMinutes > overtimeThresholdMinutes) {
                    totalMinutes += overtimeThresholdMinutes;
                    overtimeMinutes += dayWorkMinutes - overtimeThresholdMinutes;
                  } else {
                    totalMinutes += dayWorkMinutes;
                  }
                }
              }
              current.setDate(current.getDate() + 1);
              current.setHours(settings.workStartHour, settings.workStartMinute, 0, 0);
            }
            
            const regularEarnings = (totalMinutes / 60) * settings.hourlyRate;
            const overtimeEarnings = (overtimeMinutes / 60) * settings.hourlyRate * settings.overtimeMultiplier;
            return regularEarnings + overtimeEarnings;
          };

          const calculateAfterTaxEarnings = (grossEarnings) => {
            const totalTaxRate = (settings.federalTaxRate + settings.stateTaxRate + settings.socialSecurityRate + settings.medicareRate) / 100;
            const afterTaxEarnings = grossEarnings * (1 - totalTaxRate);
            return Math.max(0, afterTaxEarnings - (view === 'payPeriod' ? settings.otherDeductions : 0));
          };

          // Memoized date ranges for better performance
          const dateRanges = useMemo(() => {
            const now = new Date(currentTime);
            const todayStart = new Date(now);
            todayStart.setHours(settings.workStartHour, settings.workStartMinute, 0, 0);
            
            const weekStart = new Date(now);
            const daysFromMonday = (now.getDay() + 6) % 7;
            weekStart.setDate(now.getDate() - daysFromMonday);
            weekStart.setHours(settings.workStartHour, settings.workStartMinute, 0, 0);
            
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);
            monthStart.setHours(settings.workStartHour, settings.workStartMinute, 0, 0);
            
            const yearStart = new Date(now.getFullYear(), 0, 1);
            yearStart.setHours(settings.workStartHour, settings.workStartMinute, 0, 0);
            
            const payPeriodStart = getPayPeriodStart(now);
            
            return { todayStart, weekStart, monthStart, yearStart, payPeriodStart };
          }, [currentTime, settings]);

          // Memoized earnings calculations
          const grossEarnings = useMemo(() => ({
            today: calculateEarnings(dateRanges.todayStart),
            week: calculateEarnings(dateRanges.weekStart),
            month: calculateEarnings(dateRanges.monthStart),
            year: calculateEarnings(dateRanges.yearStart),
            payPeriod: calculateEarnings(dateRanges.payPeriodStart)
          }), [dateRanges, settings]);

          const afterTaxEarnings = useMemo(() => ({
            today: calculateAfterTaxEarnings(grossEarnings.today),
            week: calculateAfterTaxEarnings(grossEarnings.week),
            month: calculateAfterTaxEarnings(grossEarnings.month),
            year: calculateAfterTaxEarnings(grossEarnings.year),
            payPeriod: calculateAfterTaxEarnings(grossEarnings.payPeriod)
          }), [grossEarnings]);

          const isCurrentlyEarning = isWorkDay(currentTime) && isWorkTime(currentTime);
          const earningsPerSecond = settings.hourlyRate / 3600;
          const afterTaxPerSecond = calculateAfterTaxEarnings(earningsPerSecond);

          // Check for dollar milestones and play sound
          useEffect(() => {
            const currentEarnings = afterTaxEarnings[view];
            const currentDollarAmount = Math.floor(currentEarnings);
            
            if (currentDollarAmount > lastDollarAmount && lastDollarAmount > 0 && isCurrentlyEarning) {
              playChaChing();
            }
            
            setLastDollarAmount(currentDollarAmount);
          }, [afterTaxEarnings, view, lastDollarAmount, isCurrentlyEarning, soundEnabled]);

          const handleSettingsChange = (field, value) => {
            setSettings(prev => ({
              ...prev,
              [field]: field === 'payPeriodStartDate' ? value : (parseFloat(value) || 0)
            }));
          };

          const handleGoalChange = (period, value) => {
            setGoals(prev => ({
              ...prev,
              [period]: parseFloat(value) || 0
            }));
          };

          const handleInvestmentChange = (field, value) => {
            setInvestmentSettings(prev => ({
              ...prev,
              [field]: parseFloat(value) || 0
            }));
          };

          // Investment calculation functions
          const calculateCompoundInterest = (principal, rate, time, monthlyContribution = 0) => {
            const monthlyRate = rate / 12 / 100;
            const totalMonths = time * 12;
            
            // Future value of lump sum
            const lumpSumFV = principal * Math.pow(1 + monthlyRate, totalMonths);
            
            // Future value of monthly contributions (annuity)
            const annuityFV = monthlyContribution * 
              ((Math.pow(1 + monthlyRate, totalMonths) - 1) / monthlyRate);
            
            return lumpSumFV + annuityFV;
          };

          const getInvestmentProjections = () => {
            const earnings = afterTaxEarnings[view];
            const { annualReturn, timeHorizon, monthlyContribution } = investmentSettings;
            
            // Calculate what current earnings could be worth if invested
            const futureValue = calculateCompoundInterest(
              earnings, 
              annualReturn, 
              timeHorizon, 
              monthlyContribution
            );
            
            // Calculate just the growth (excluding principal and contributions)
            const totalContributions = (monthlyContribution * 12 * timeHorizon);
            const totalGrowth = futureValue - earnings - totalContributions;
            
            // Different time horizons for comparison
            const projections = {
              '10yr': calculateCompoundInterest(earnings, annualReturn, 10, monthlyContribution),
              '20yr': calculateCompoundInterest(earnings, annualReturn, 20, monthlyContribution),
              '30yr': calculateCompoundInterest(earnings, annualReturn, 30, monthlyContribution),
              'custom': futureValue
            };
            
            return {
              futureValue,
              totalGrowth,
              projections,
              monthlyGrowth: monthlyContribution > 0 ? 
                calculateCompoundInterest(0, annualReturn, timeHorizon, monthlyContribution) : 0
            };
          };

          const investmentData = getInvestmentProjections();

          const formatCurrency = (amount) => `$${amount.toFixed(2)}`;
          
          const getViewLabel = () => {
            switch(view) {
              case 'today': return 'Today';
              case 'week': return 'This Week';
              case 'month': return 'This Month';
              case 'year': return 'This Year';
              case 'payPeriod': return 'This Pay Period';
              default: return '';
            }
          };

          // Goal progress calculation
          const getGoalProgress = () => {
            const current = afterTaxEarnings[view];
            let goal;
            
            switch(view) {
              case 'today':
                goal = goals.daily;
                break;
              case 'week':
                goal = goals.weekly;
                break;
              case 'month':
                goal = goals.monthly;
                break;
              default:
                return null;
            }
            
            return goal ? (current / goal) * 100 : 0;
          };

          const goalProgress = getGoalProgress();

          return (
            <div className="min-h-screen bg-gray-50" style={{fontFamily: '-apple-system, BlinkMacSystemFont, "SF Pro Display", "SF Pro Text", system-ui, sans-serif'}}>
              <div className="max-w-sm mx-auto bg-white min-h-screen">
                {/* Status Bar Space */}
                <div className="h-12 bg-white"></div>
                
                {/* Header */}
                <div className="bg-white border-b border-gray-200 px-4 py-3">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center space-x-3">
                      <div className="text-2xl">ðŸ’°</div>
                      <div>
                        <h1 className="text-lg font-semibold text-black">Earnings</h1>
                        <p className="text-xs text-gray-500">Live Tracker</p>
                      </div>
                    </div>
                    <div className="flex items-center space-x-2">
                      <button
                        onClick={() => setShowInvestmentCalc(!showInvestmentCalc)}
                        className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center"
                        title="Investment Calculator"
                      >
                        <PieChart size={18} className="text-gray-600" />
                      </button>
                      <button
                        onClick={() => setShowGoals(!showGoals)}
                        className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center"
                        title="Goals"
                      >
                        <Target size={18} className="text-gray-600" />
                      </button>
                      <button
                        onClick={() => setShowSettings(!showSettings)}
                        className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center"
                        title="Settings"
                      >
                        <Settings size={18} className="text-gray-600" />
                      </button>
                    </div>
                  </div>
                </div>

                {/* Status Card */}
                <div className="mx-4 mt-4 bg-white rounded-xl shadow-sm border border-gray-200">
                  <div className="p-4">
                    <div className="flex items-center justify-between mb-3">
                      <div className="flex items-center space-x-2">
                        <div className={`w-2 h-2 rounded-full ${isCurrentlyEarning ? 'bg-green-500' : 'bg-gray-400'}`}></div>
                        <span className="text-sm font-medium text-black">
                          {isCurrentlyEarning ? 'On the Clock' : 'Off the Clock'}
                        </span>
                        {isCurrentlyEarning && <Zap size={16} className="text-green-500" />}
                      </div>
                      <button
                        onClick={() => setSoundEnabled(!soundEnabled)}
                        className="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center"
                      >
                        <span className="text-sm">{soundEnabled ? 'ðŸ”Š' : 'ðŸ”‡'}</span>
                      </button>
                    </div>
                    
                    {isCurrentlyEarning && (
                      <div className="space-y-1">
                        <div className="text-xs text-gray-500">
                          +{formatCurrency(afterTaxPerSecond)}/sec take-home
                        </div>
                        <div className="text-xs text-gray-500">
                          +{formatCurrency(earningsPerSecond)}/sec gross
                        </div>
                      </div>
                    )}
                  </div>
                </div>

                {/* Goal Progress (when applicable) */}
                {goalProgress !== null && goalProgress > 0 && (
                  <div className="mx-4 mt-4 bg-white rounded-xl shadow-sm border border-gray-200">
                    <div className="p-4">
                      <div className="flex items-center justify-between mb-2">
                        <div className="text-sm font-medium text-black">Goal Progress</div>
                        <div className="text-sm font-semibold" style={{color: '#007AFF'}}>
                          {Math.min(goalProgress, 100).toFixed(0)}%
                        </div>
                      </div>
                      <div className="w-full bg-gray-200 rounded-full h-2">
                        <div 
                          className="h-2 rounded-full transition-all duration-300" 
                          style={{
                            width: `${Math.min(goalProgress, 100)}%`,
                            backgroundColor: goalProgress >= 100 ? '#10b981' : '#007AFF'
                          }}
                        ></div>
                      </div>
                      {goalProgress >= 100 && (
                        <div className="text-xs text-green-600 mt-1 font-medium">ðŸŽ‰ Goal achieved!</div>
                      )}
                    </div>
                  </div>
                )}

                {/* Time Period Selector */}
                <div className="mx-4 mt-4">
                  <div className="bg-gray-100 rounded-lg p-1 flex">
                    {[
                      { key: 'today', label: 'Today' },
                      { key: 'week', label: 'Week' },
                      { key: 'month', label: 'Month' },
                      { key: 'year', label: 'Year' },
                      { key: 'payPeriod', label: 'Period' }
                    ].map(({ key, label }) => (
                      <button
                        key={key}
                        onClick={() => setView(key)}
                        className={`flex-1 py-2 px-2 rounded-md text-xs font-medium transition-all ${
                          view === key 
                            ? 'bg-white text-black shadow-sm' 
                            : 'text-gray-600'
                        }`}
                      >
                        {label}
                      </button>
                    ))}
                  </div>
                </div>

                {/* Earnings Cards */}
                <div className="mx-4 mt-4 space-y-3">
                  <div className="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div className="p-4">
                      <div className="text-xs text-gray-500 mb-1 uppercase font-medium tracking-wide">GROSS {getViewLabel().toUpperCase()}</div>
                      <div className="text-2xl font-bold text-black mb-1">
                        {formatCurrency(grossEarnings[view])}
                      </div>
                      <div className="text-xs text-gray-500">Before taxes & deductions</div>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div className="p-4">
                      <div className="text-xs font-medium mb-1 uppercase tracking-wide" style={{color: '#007AFF'}}>TAKE-HOME {getViewLabel().toUpperCase()}</div>
                      <div className="text-2xl font-bold mb-1" style={{color: '#007AFF'}}>
                        {formatCurrency(afterTaxEarnings[view])}
                      </div>
                      <div className="text-xs text-gray-500">After taxes & deductions</div>
                    </div>
                  </div>
                </div>

                {/* DEBUG: Investment Opportunity Card - Should always show for testing */}
                <div className="mx-4 mt-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl shadow-sm border border-purple-200">
                  <div className="p-4">
                    <div className="flex items-center justify-between mb-2">
                      <div className="flex items-center space-x-2">
                        <TrendingUp size={16} className="text-purple-600" />
                        <div className="text-sm font-medium text-purple-900">Investment Opportunity (Test)</div>
                      </div>
                      <button
                        onClick={() => setShowInvestmentCalc(true)}
                        className="text-xs text-purple-600 font-medium"
                      >
                        Details
                      </button>
                    </div>
                    <div className="text-lg font-bold text-purple-900 mb-1">
                      {formatCurrency(investmentData.projections['30yr'])}
                    </div>
                    <div className="text-xs text-purple-700">
                      If invested at {investmentSettings.annualReturn}% for 30 years
                    </div>
                    <div className="text-xs text-purple-600 mt-1">
                      ðŸ’¡ That's {formatCurrency(investmentData.projections['30yr'] - afterTaxEarnings[view])} in growth!
                    </div>
                    <div className="text-xs text-gray-500 mt-2">
                      DEBUG INFO: View={view}, Earnings=${afterTaxEarnings[view].toFixed(2)}
                    </div>
                  </div>
                </div>

                {/* Investment Opportunity Card */}
                {view !== 'year' && afterTaxEarnings[view] > 0 && (
                  <div className="mx-4 mt-4 bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl shadow-sm border border-purple-200">
                    <div className="p-4">
                      <div className="flex items-center justify-between mb-2">
                        <div className="flex items-center space-x-2">
                          <TrendingUp size={16} className="text-purple-600" />
                          <div className="text-sm font-medium text-purple-900">Investment Opportunity</div>
                        </div>
                        <button
                          onClick={() => setShowInvestmentCalc(true)}
                          className="text-xs text-purple-600 font-medium"
                        >
                          Details
                        </button>
                      </div>
                      <div className="text-lg font-bold text-purple-900 mb-1">
                        {formatCurrency(investmentData.projections['30yr'])}
                      </div>
                      <div className="text-xs text-purple-700">
                        If invested at {investmentSettings.annualReturn}% for 30 years
                      </div>
                      <div className="text-xs text-purple-600 mt-1">
                        ðŸ’¡ That's {formatCurrency(investmentData.projections['30yr'] - afterTaxEarnings[view])} in growth!
                      </div>
                    </div>
                  </div>
                )}
                <div className="mx-4 mt-4">
                  <div className="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div className="divide-y divide-gray-200">
                      <div className="p-4 flex justify-between items-center">
                        <div>
                          <div className="text-sm font-medium text-black">Hourly Rate</div>
                          <div className="text-xs text-gray-500">Gross pay</div>
                        </div>
                        <div className="text-sm font-semibold text-black">{formatCurrency(settings.hourlyRate)}</div>
                      </div>
                      
                      <div className="p-4 flex justify-between items-center">
                        <div>
                          <div className="text-sm font-medium text-black">Tax Rate</div>
                          <div className="text-xs text-gray-500">Total burden</div>
                        </div>
                        <div className="text-sm font-semibold text-black">
                          {(settings.federalTaxRate + settings.stateTaxRate + settings.socialSecurityRate + settings.medicareRate).toFixed(1)}%
                        </div>
                      </div>
                      
                      <div className="p-4 flex justify-between items-center">
                        <div>
                          <div className="text-sm font-medium text-black">Take-Home Rate</div>
                          <div className="text-xs text-gray-500">After taxes</div>
                        </div>
                        <div className="text-sm font-semibold" style={{color: '#007AFF'}}>
                          {formatCurrency(settings.hourlyRate * (1 - (settings.federalTaxRate + settings.stateTaxRate + settings.socialSecurityRate + settings.medicareRate) / 100))}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Current Time */}
                <div className="mx-4 mt-4 text-center">
                  <div className="text-xs text-gray-500">
                    {currentTime.toLocaleTimeString()}
                  </div>
                </div>

                {/* Investment Calculator Modal */}
                {showInvestmentCalc && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end">
                    <div className="bg-white w-full rounded-t-2xl max-h-[85vh] overflow-hidden">
                      <div className="bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between">
                        <button
                          onClick={() => setShowInvestmentCalc(false)}
                          className="font-medium"
                          style={{color: '#007AFF'}}
                        >
                          Done
                        </button>
                        <h2 className="text-lg font-semibold text-black">Investment Calculator</h2>
                        <div className="w-12"></div>
                      </div>
                      
                      <div className="overflow-y-auto max-h-[calc(85vh-60px)]">
                        <div className="p-4 space-y-6">
                          
                          {/* Current Earnings Display */}
                          <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-xl border border-blue-200">
                            <div className="p-4">
                              <div className="text-center">
                                <div className="text-sm text-blue-700 mb-1">Your {getViewLabel()} Earnings</div>
                                <div className="text-2xl font-bold text-blue-900">
                                  {formatCurrency(afterTaxEarnings[view])}
                                </div>
                                <div className="text-xs text-blue-600 mt-1">Take-home pay</div>
                              </div>
                            </div>
                          </div>

                          {/* Investment Settings */}
                          <div>
                            <div className="text-xs text-gray-500 mb-3 uppercase font-medium tracking-wide">Investment Assumptions</div>
                            <div className="bg-white rounded-xl border border-gray-200 divide-y divide-gray-200">
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div>
                                    <div className="text-sm font-medium text-black">Annual Return</div>
                                    <div className="text-xs text-gray-500">Expected yearly growth (%)</div>
                                  </div>
                                  <input
                                    type="number"
                                    step="0.1"
                                    min="0"
                                    max="20"
                                    value={investmentSettings.annualReturn}
                                    onChange={(e) => handleInvestmentChange('annualReturn', e.target.value)}
                                    className="w-16 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div>
                                    <div className="text-sm font-medium text-black">Time Horizon</div>
                                    <div className="text-xs text-gray-500">Years to invest</div>
                                  </div>
                                  <input
                                    type="number"
                                    step="1"
                                    min="1"
                                    max="50"
                                    value={investmentSettings.timeHorizon}
                                    onChange={(e) => handleInvestmentChange('timeHorizon', e.target.value)}
                                    className="w-16 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div>
                                    <div className="text-sm font-medium text-black">Monthly Addition</div>
                                    <div className="text-xs text-gray-500">Extra monthly investment</div>
                                  </div>
                                  <input
                                    type="number"
                                    step="10"
                                    min="0"
                                    value={investmentSettings.monthlyContribution}
                                    onChange={(e) => handleInvestmentChange('monthlyContribution', e.target.value)}
                                    className="w-20 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                    placeholder="0"
                                  />
                                </div>
                              </div>
                            </div>
                          </div>

                          {/* Investment Projections */}
                          <div>
                            <div className="text-xs text-gray-500 mb-3 uppercase font-medium tracking-wide">Future Value Projections</div>
                            <div className="space-y-3">
                              
                              {/* 10 Year */}
                              <div className="bg-white rounded-xl border border-gray-200">
                                <div className="p-4">
                                  <div className="flex justify-between items-center">
                                    <div>
                                      <div className="text-sm font-medium text-black">10 Years</div>
                                      <div className="text-xs text-gray-500">
                                        {((investmentData.projections['10yr'] / afterTaxEarnings[view]) - 1).toFixed(1)}x your current earnings
                                      </div>
                                    </div>
                                    <div className="text-right">
                                      <div className="text-lg font-bold text-green-600">
                                        {formatCurrency(investmentData.projections['10yr'])}
                                      </div>
                                      <div className="text-xs text-gray-500">
                                        +{formatCurrency(investmentData.projections['10yr'] - afterTaxEarnings[view])}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              {/* 20 Year */}
                              <div className="bg-white rounded-xl border border-gray-200">
                                <div className="p-4">
                                  <div className="flex justify-between items-center">
                                    <div>
                                      <div className="text-sm font-medium text-black">20 Years</div>
                                      <div className="text-xs text-gray-500">
                                        {((investmentData.projections['20yr'] / afterTaxEarnings[view]) - 1).toFixed(1)}x your current earnings
                                      </div>
                                    </div>
                                    <div className="text-right">
                                      <div className="text-lg font-bold text-green-600">
                                        {formatCurrency(investmentData.projections['20yr'])}
                                      </div>
                                      <div className="text-xs text-gray-500">
                                        +{formatCurrency(investmentData.projections['20yr'] - afterTaxEarnings[view])}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              {/* 30 Year */}
                              <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-200">
                                <div className="p-4">
                                  <div className="flex justify-between items-center">
                                    <div>
                                      <div className="text-sm font-medium text-green-900">30 Years</div>
                                      <div className="text-xs text-green-700">
                                        {((investmentData.projections['30yr'] / afterTaxEarnings[view]) - 1).toFixed(1)}x your current earnings
                                      </div>
                                    </div>
                                    <div className="text-right">
                                      <div className="text-lg font-bold text-green-700">
                                        {formatCurrency(investmentData.projections['30yr'])}
                                      </div>
                                      <div className="text-xs text-green-600">
                                        +{formatCurrency(investmentData.projections['30yr'] - afterTaxEarnings[view])}
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              </div>

                              {/* Custom Time Horizon (if different from 30) */}
                              {investmentSettings.timeHorizon !== 30 && (
                                <div className="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl border border-purple-200">
                                  <div className="p-4">
                                    <div className="flex justify-between items-center">
                                      <div>
                                        <div className="text-sm font-medium text-purple-900">{investmentSettings.timeHorizon} Years</div>
                                        <div className="text-xs text-purple-700">Your custom timeline</div>
                                      </div>
                                      <div className="text-right">
                                        <div className="text-lg font-bold text-purple-700">
                                          {formatCurrency(investmentData.futureValue)}
                                        </div>
                                        <div className="text-xs text-purple-600">
                                          +{formatCurrency(investmentData.totalGrowth)}
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                </div>
                              )}
                            </div>
                          </div>

                          {/* Key Insights */}
                          <div>
                            <div className="text-xs text-gray-500 mb-3 uppercase font-medium tracking-wide">Key Insights</div>
                            <div className="bg-blue-50 rounded-xl border border-blue-200">
                              <div className="p-4 space-y-3">
                                <div className="flex items-start space-x-3">
                                  <div className="text-blue-600">ðŸš€</div>
                                  <div>
                                    <div className="text-sm font-medium text-blue-900">Power of Compound Interest</div>
                                    <div className="text-xs text-blue-700">
                                      Your {formatCurrency(afterTaxEarnings[view])} could grow to {formatCurrency(investmentData.projections['30yr'])} in 30 years
                                    </div>
                                  </div>
                                </div>
                                
                                {investmentSettings.monthlyContribution > 0 && (
                                  <div className="flex items-start space-x-3">
                                    <div className="text-blue-600">ðŸ’ª</div>
                                    <div>
                                      <div className="text-sm font-medium text-blue-900">Regular Investing</div>
                                      <div className="text-xs text-blue-700">
                                        Adding ${investmentSettings.monthlyContribution}/month would contribute {formatCurrency(investmentData.monthlyGrowth)} to your total
                                      </div>
                                    </div>
                                  </div>
                                )}
                                
                                <div className="flex items-start space-x-3">
                                  <div className="text-blue-600">â°</div>
                                  <div>
                                    <div className="text-sm font-medium text-blue-900">Time is Your Friend</div>
                                    <div className="text-xs text-blue-700">
                                      Starting early makes a huge difference - every year counts!
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>

                          {/* Disclaimer */}
                          <div className="pb-8">
                            <div className="bg-gray-50 rounded-xl border border-gray-200">
                              <div className="p-4">
                                <div className="text-xs text-gray-600 leading-relaxed">
                                  <strong>Disclaimer:</strong> These projections are estimates based on your input assumptions. 
                                  Actual investment returns vary and past performance doesn't guarantee future results. 
                                  Consider consulting a financial advisor for personalized investment advice.
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Goals Modal */}
                {showGoals && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end">
                    <div className="bg-white w-full rounded-t-2xl max-h-[85vh] overflow-hidden">
                      <div className="bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between">
                        <button
                          onClick={() => setShowGoals(false)}
                          className="font-medium"
                          style={{color: '#007AFF'}}
                        >
                          Done
                        </button>
                        <h2 className="text-lg font-semibold text-black">Goals</h2>
                        <div className="w-12"></div>
                      </div>
                      
                      <div className="p-4 space-y-4">
                        <div className="text-xs text-gray-500 mb-3 uppercase font-medium tracking-wide">Earning Goals (Take-Home)</div>
                        
                        <div className="bg-white rounded-xl border border-gray-200 divide-y divide-gray-200">
                          <div className="p-4">
                            <div className="flex justify-between items-center">
                              <div className="text-sm font-medium text-black">Daily Goal</div>
                              <input
                                type="number"
                                step="1"
                                value={goals.daily}
                                onChange={(e) => handleGoalChange('daily', e.target.value)}
                                className="w-20 text-right bg-transparent font-medium border-none outline-none"
                                style={{color: '#007AFF'}}
                                placeholder="0"
                              />
                            </div>
                          </div>
                          
                          <div className="p-4">
                            <div className="flex justify-between items-center">
                              <div className="text-sm font-medium text-black">Weekly Goal</div>
                              <input
                                type="number"
                                step="1"
                                value={goals.weekly}
                                onChange={(e) => handleGoalChange('weekly', e.target.value)}
                                className="w-20 text-right bg-transparent font-medium border-none outline-none"
                                style={{color: '#007AFF'}}
                                placeholder="0"
                              />
                            </div>
                          </div>
                          
                          <div className="p-4">
                            <div className="flex justify-between items-center">
                              <div className="text-sm font-medium text-black">Monthly Goal</div>
                              <input
                                type="number"
                                step="1"
                                value={goals.monthly}
                                onChange={(e) => handleGoalChange('monthly', e.target.value)}
                                className="w-20 text-right bg-transparent font-medium border-none outline-none"
                                style={{color: '#007AFF'}}
                                placeholder="0"
                              />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Settings Modal */}
                {showSettings && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end">
                    <div className="bg-white w-full rounded-t-2xl max-h-[85vh] overflow-hidden">
                      {/* Settings Header */}
                      <div className="bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between">
                        <button
                          onClick={() => setShowSettings(false)}
                          className="font-medium"
                          style={{color: '#007AFF'}}
                        >
                          Done
                        </button>
                        <h2 className="text-lg font-semibold text-black">Settings</h2>
                        <div className="w-12"></div>
                      </div>
                      
                      {/* Settings Content */}
                      <div className="overflow-y-auto max-h-[calc(85vh-60px)]">
                        <div className="p-4 space-y-6">
                          
                          {/* PDF Upload Section */}
                          <div>
                            <div className="text-xs text-gray-500 mb-3 uppercase font-medium tracking-wide">Import Pay Stub</div>
                            <div className="bg-white rounded-xl border border-gray-200">
                              <div className="p-4">
                                <div className="text-center">
                                  <div className="mb-3">
                                    <div className="text-sm font-medium text-black mb-1">Upload Pay Stub PDF</div>
                                    <div className="text-xs text-gray-500">Automatically detect rates and deductions</div>
                                  </div>
                                  
                                  <input
                                    type="file"
                                    accept=".pdf"
                                    onChange={handleFileUpload}
                                    disabled={isParsingPDF}
                                    className="hidden"
                                    id="pdf-upload"
                                  />
                                  
                                  <label
                                    htmlFor="pdf-upload"
                                    className={`inline-block px-4 py-2 rounded-lg font-medium cursor-pointer transition-colors ${
                                      isParsingPDF 
                                        ? 'bg-gray-100 text-gray-400' 
                                        : 'bg-blue-50 hover:bg-blue-100'
                                    }`}
                                    style={{color: isParsingPDF ? '#9CA3AF' : '#007AFF'}}
                                  >
                                    {isParsingPDF ? 'Parsing PDF...' : 'Choose PDF File'}
                                  </label>
                                </div>
                              </div>
                            </div>
                          </div>

                          {/* Parsed Data Preview */}
                          {parsedPayStub && (
                            <div>
                              <div className="text-xs text-gray-500 mb-3 uppercase font-medium tracking-wide">Detected Values</div>
                              <div className="bg-blue-50 rounded-xl border border-blue-200">
                                <div className="p-4">
                                  <div className="space-y-2 mb-4">
                                    {parsedPayStub.hourlyRate && (
                                      <div className="flex justify-between text-sm">
                                        <span>Hourly Rate:</span>
                                        <span className="font-medium">${parsedPayStub.hourlyRate}</span>
                                      </div>
                                    )}
                                    {parsedPayStub.federalTaxRate && (
                                      <div className="flex justify-between text-sm">
                                        <span>Federal Tax:</span>
                                        <span className="font-medium">{parsedPayStub.federalTaxRate}%</span>
                                      </div>
                                    )}
                                    {parsedPayStub.stateTaxRate && (
                                      <div className="flex justify-between text-sm">
                                        <span>State Tax:</span>
                                        <span className="font-medium">{parsedPayStub.stateTaxRate}%</span>
                                      </div>
                                    )}
                                    {parsedPayStub.socialSecurityRate && (
                                      <div className="flex justify-between text-sm">
                                        <span>Social Security:</span>
                                        <span className="font-medium">{parsedPayStub.socialSecurityRate}%</span>
                                      </div>
                                    )}
                                    {parsedPayStub.medicareRate && (
                                      <div className="flex justify-between text-sm">
                                        <span>Medicare:</span>
                                        <span className="font-medium">{parsedPayStub.medicareRate}%</span>
                                      </div>
                                    )}
                                    {parsedPayStub.otherDeductions && (
                                      <div className="flex justify-between text-sm">
                                        <span>Other Deductions:</span>
                                        <span className="font-medium">${parsedPayStub.otherDeductions}</span>
                                      </div>
                                    )}
                                    {parsedPayStub.payPeriodLength && (
                                      <div className="flex justify-between text-sm">
                                        <span>Pay Period:</span>
                                        <span className="font-medium">{parsedPayStub.payPeriodLength} days</span>
                                      </div>
                                    )}
                                  </div>
                                  
                                  <div className="flex space-x-3">
                                    <button
                                      onClick={applyParsedData}
                                      className="flex-1 py-2 px-4 rounded-lg font-medium text-white"
                                      style={{backgroundColor: '#007AFF'}}
                                    >
                                      Apply Values
                                    </button>
                                    <button
                                      onClick={() => setParsedPayStub(null)}
                                      className="flex-1 py-2 px-4 rounded-lg font-medium bg-gray-100 text-gray-600"
                                    >
                                      Cancel
                                    </button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          )}
                          
                          {/* Work Settings Section */}
                          <div>
                            <div className="text-xs text-gray-500 mb-3 uppercase font-medium tracking-wide">Work Schedule</div>
                            <div className="bg-white rounded-xl border border-gray-200 divide-y divide-gray-200">
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div>
                                    <div className="text-sm font-medium text-black">Hourly Rate</div>
                                    <div className="text-xs text-gray-500">Gross pay per hour</div>
                                  </div>
                                  <input
                                    type="number"
                                    inputMode="decimal"
                                    step="0.01"
                                    value={settings.hourlyRate}
                                    onChange={(e) => handleSettingsChange('hourlyRate', e.target.value)}
                                    className="w-20 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                    placeholder="0.00"
                                  />
                                </div>
                              </div>

                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div>
                                    <div className="text-sm font-medium text-black">Overtime After</div>
                                    <div className="text-xs text-gray-500">Hours per day</div>
                                  </div>
                                  <input
                                    type="number"
                                    step="0.5"
                                    value={settings.overtimeThreshold}
                                    onChange={(e) => handleSettingsChange('overtimeThreshold', e.target.value)}
                                    className="w-16 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>

                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div>
                                    <div className="text-sm font-medium text-black">Overtime Rate</div>
                                    <div className="text-xs text-gray-500">Multiplier (e.g., 1.5x)</div>
                                  </div>
                                  <input
                                    type="number"
                                    step="0.1"
                                    value={settings.overtimeMultiplier}
                                    onChange={(e) => handleSettingsChange('overtimeMultiplier', e.target.value)}
                                    className="w-16 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div className="text-sm font-medium text-black">Work Start</div>
                                  <input
                                    type="time"
                                    value={`${settings.workStartHour.toString().padStart(2, '0')}:${settings.workStartMinute.toString().padStart(2, '0')}`}
                                    onChange={(e) => {
                                      const [hours, minutes] = e.target.value.split(':');
                                      handleSettingsChange('workStartHour', parseInt(hours));
                                      handleSettingsChange('workStartMinute', parseInt(minutes));
                                    }}
                                    className="bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div className="text-sm font-medium text-black">Work End</div>
                                  <input
                                    type="time"
                                    value={`${settings.workEndHour.toString().padStart(2, '0')}:${settings.workEndMinute.toString().padStart(2, '0')}`}
                                    onChange={(e) => {
                                      const [hours, minutes] = e.target.value.split(':');
                                      handleSettingsChange('workEndHour', parseInt(hours));
                                      handleSettingsChange('workEndMinute', parseInt(minutes));
                                    }}
                                    className="bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div className="text-sm font-medium text-black">Lunch Start</div>
                                  <input
                                    type="time"
                                    value={`${settings.lunchStartHour.toString().padStart(2, '0')}:${settings.lunchStartMinute.toString().padStart(2, '0')}`}
                                    onChange={(e) => {
                                      const [hours, minutes] = e.target.value.split(':');
                                      handleSettingsChange('lunchStartHour', parseInt(hours));
                                      handleSettingsChange('lunchStartMinute', parseInt(minutes));
                                    }}
                                    className="bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div className="text-sm font-medium text-black">Lunch End</div>
                                  <input
                                    type="time"
                                    value={`${settings.lunchEndHour.toString().padStart(2, '0')}:${settings.lunchEndMinute.toString().padStart(2, '0')}`}
                                    onChange={(e) => {
                                      const [hours, minutes] = e.target.value.split(':');
                                      handleSettingsChange('lunchEndHour', parseInt(hours));
                                      handleSettingsChange('lunchEndMinute', parseInt(minutes));
                                    }}
                                    className="bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                            </div>
                          </div>

                          {/* Pay Period Section */}
                          <div>
                            <div className="text-xs text-gray-500 mb-3 uppercase font-medium tracking-wide">Pay Period</div>
                            <div className="bg-white rounded-xl border border-gray-200 divide-y divide-gray-200">
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div className="text-sm font-medium text-black">Start Date</div>
                                  <input
                                    type="date"
                                    value={settings.payPeriodStartDate}
                                    onChange={(e) => handleSettingsChange('payPeriodStartDate', e.target.value)}
                                    className="bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div className="text-sm font-medium text-black">Length</div>
                                  <select
                                    value={settings.payPeriodLength}
                                    onChange={(e) => handleSettingsChange('payPeriodLength', e.target.value)}
                                    className="bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  >
                                    <option value={7}>Weekly</option>
                                    <option value={14}>Bi-weekly</option>
                                    <option value={15}>Semi-monthly</option>
                                    <option value={30}>Monthly</option>
                                  </select>
                                </div>
                              </div>
                            </div>
                          </div>

                          {/* Tax Settings Section */}
                          <div>
                            <div className="text-xs text-gray-500 mb-3 uppercase font-medium tracking-wide">Tax Rates (%)</div>
                            <div className="bg-white rounded-xl border border-gray-200 divide-y divide-gray-200">
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div className="text-sm font-medium text-black">Federal Tax</div>
                                  <input
                                    type="number"
                                    inputMode="decimal"
                                    step="0.1"
                                    min="0"
                                    max="100"
                                    value={settings.federalTaxRate}
                                    onChange={(e) => handleSettingsChange('federalTaxRate', e.target.value)}
                                    className="w-16 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div className="text-sm font-medium text-black">State Tax</div>
                                  <input
                                    type="number"
                                    inputMode="decimal"
                                    step="0.1"
                                    min="0"
                                    max="100"
                                    value={settings.stateTaxRate}
                                    onChange={(e) => handleSettingsChange('stateTaxRate', e.target.value)}
                                    className="w-16 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div className="text-sm font-medium text-black">Social Security</div>
                                  <input
                                    type="number"
                                    inputMode="decimal"
                                    step="0.1"
                                    min="0"
                                    max="100"
                                    value={settings.socialSecurityRate}
                                    onChange={(e) => handleSettingsChange('socialSecurityRate', e.target.value)}
                                    className="w-16 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                              
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div className="text-sm font-medium text-black">Medicare</div>
                                  <input
                                    type="number"
                                    inputMode="decimal"
                                    step="0.1"
                                    min="0"
                                    max="100"
                                    value={settings.medicareRate}
                                    onChange={(e) => handleSettingsChange('medicareRate', e.target.value)}
                                    className="w-16 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                  />
                                </div>
                              </div>
                            </div>
                          </div>

                          {/* Deductions Section */}
                          <div className="pb-8">
                            <div className="text-xs text-gray-500 mb-3 uppercase font-medium tracking-wide">Deductions</div>
                            <div className="bg-white rounded-xl border border-gray-200">
                              <div className="p-4">
                                <div className="flex justify-between items-center">
                                  <div>
                                    <div className="text-sm font-medium text-black">Other Deductions</div>
                                    <div className="text-xs text-gray-500">Per pay period</div>
                                  </div>
                                  <input
                                    type="number"
                                    inputMode="decimal"
                                    step="0.01"
                                    value={settings.otherDeductions}
                                    onChange={(e) => handleSettingsChange('otherDeductions', e.target.value)}
                                    className="w-20 text-right bg-transparent font-medium border-none outline-none"
                                    style={{color: '#007AFF'}}
                                    placeholder="0.00"
                                  />
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Install Prompt */}
                {showInstallPrompt && (
                  <div className="fixed bottom-4 left-4 right-4 bg-white rounded-xl shadow-lg border border-gray-200 p-4 z-40">
                    <div className="flex items-center justify-between">
                      <div className="flex items-center space-x-3">
                        <div className="text-2xl">ðŸ“±</div>
                        <div>
                          <div className="text-sm font-medium text-black">Install App</div>
                          <div className="text-xs text-gray-500">Add to home screen for quick access</div>
                        </div>
                      </div>
                      <div className="flex space-x-2">
                        <button
                          onClick={() => setShowInstallPrompt(false)}
                          className="px-3 py-1 text-xs bg-gray-100 text-gray-600 rounded-lg"
                        >
                          Not Now
                        </button>
                        <button
                          onClick={handleInstallClick}
                          className="px-3 py-1 text-xs text-white rounded-lg"
                          style={{backgroundColor: '#007AFF'}}
                        >
                          Install
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* Bottom Safe Area */}
                <div className="h-8"></div>
              </div>
            </div>
          );
        };

        ReactDOM.render(<LiveEarningsTracker />, document.getElementById('root'));
    </script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>
                
